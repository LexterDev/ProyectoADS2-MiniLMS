<main class="min-h-screen bg-background-light dark:bg-background-dark">

  <app-sidebar-instructor #sidebar></app-sidebar-instructor>

  <div class="lg:ml-64 min-h-screen py-8">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">

      <!-- Header -->
      <div class="mb-6">
        <div class="flex items-center justify-between flex-wrap gap-4">
          <div>
            <h1 class="text-3xl font-bold text-neutral-900 dark:text-white mb-2">
              Mis Cursos
            </h1>
            <p class="text-neutral-600 dark:text-neutral-400">
              Administra y gestiona tus cursos
            </p>
          </div>
          <button
            routerLink="/courses/create"
            class="flex items-center gap-2 px-4 py-2 text-sm font-medium text-white bg-primary-600 hover:bg-primary-700 dark:bg-primary-500 dark:hover:bg-primary-600 rounded-lg transition-colors shadow-sm">
            <mat-icon>add</mat-icon>
            Crear Nuevo Curso
          </button>
        </div>
      </div>

      <!-- Search & Filters -->
      <div class="bg-white dark:bg-neutral-800 rounded-lg shadow-sm border border-neutral-200 dark:border-neutral-700 p-4 mb-6">
        <div class="relative">
          <mat-icon class="absolute left-3 top-1/2 -translate-y-1/2 text-neutral-400">search</mat-icon>
          <input
            type="text"
            [(ngModel)]="searchQuery"
            (input)="onSearch()"
            placeholder="Buscar por título o descripción..."
            class="w-full pl-10 pr-10 py-2 border border-neutral-300 dark:border-neutral-600 rounded-lg bg-white dark:bg-neutral-700 text-neutral-900 dark:text-white focus:ring-2 focus:ring-primary-500 focus:border-transparent">
          @if (searchQuery) {
            <button
              (click)="clearSearch()"
              class="absolute right-3 top-1/2 -translate-y-1/2 text-neutral-400 hover:text-neutral-600 dark:hover:text-neutral-200">
              <mat-icon class="text-lg">close</mat-icon>
            </button>
          }
        </div>
      </div>

      <!-- Tabs -->
      <div class="mb-6">
        <div class="border-b border-neutral-200 dark:border-neutral-700 flex gap-2 sm:gap-6">
          @for (status of statusOptions; track status.value) {
            <button
              (click)="setTab(status.value)"
              [ngClass]="activeTab === status.value
                ? 'border-primary-600 text-primary-600 dark:border-primary-500 dark:text-primary-500'
                : 'border-transparent text-neutral-500 dark:text-neutral-400 hover:text-neutral-700 dark:hover:text-neutral-300 hover:border-neutral-300 dark:hover:border-neutral-600'"
              class="flex items-center justify-center border-b-2 px-3 sm:px-4 py-3 text-sm font-semibold transition-colors whitespace-nowrap">
              {{ status.label }}
            </button>
          }
        </div>
      </div>

      <!-- Courses Grid -->
      @if (loading) {
        <div class="text-center py-12">
          <p class="text-neutral-600 dark:text-neutral-400">Cargando cursos...</p>
        </div>
      } @else if (filteredCourses.length === 0) {
        <div class="bg-white dark:bg-neutral-800 rounded-lg shadow-sm border border-neutral-200 dark:border-neutral-700 p-12 text-center">
          <mat-icon class="text-6xl text-neutral-300 dark:text-neutral-600 mb-4">school</mat-icon>
          <p class="text-lg font-medium text-neutral-900 dark:text-white mb-2">
            No se encontraron cursos
          </p>
          <p class="text-neutral-600 dark:text-neutral-400 mb-6">
            @if (searchQuery) {
              No hay cursos que coincidan con tu búsqueda
            } @else if (activeTab !== 'Todos') {
              No tienes cursos en este estado
            } @else {
              Aún no has creado ningún curso
            }
          </p>
          <button
            routerLink="/courses/create"
            class="inline-flex items-center gap-2 px-4 py-2 text-sm font-medium text-white bg-primary-600 hover:bg-primary-700 dark:bg-primary-500 dark:hover:bg-primary-600 rounded-lg transition-colors">
            <mat-icon>add</mat-icon>
            Crear Mi Primer Curso
          </button>
        </div>
      } @else {
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
          @for (course of filteredCourses; track course.id) {
            <div class="bg-white dark:bg-neutral-800 rounded-lg shadow-sm border border-neutral-200 dark:border-neutral-700 hover:shadow-md transition-all overflow-hidden">
              <!-- Course Image -->
              <div class="relative aspect-video bg-neutral-200 dark:bg-neutral-700">
                @if (course.adjunto?.url) {
                  <img
                    [src]="course.adjunto.url"
                    [alt]="course.titulo"
                    class="w-full h-full object-cover">
                } @else {
                  <div class="w-full h-full flex items-center justify-center">
                    <mat-icon class="text-6xl text-neutral-400">school</mat-icon>
                  </div>
                }
                <!-- Status Badge Overlay -->
                <div class="absolute top-3 left-3">
                  <span [class]="getStatusColor(course.estadoCodigo)" class="px-3 py-1 text-xs font-semibold rounded-full">
                    {{ getStatusLabel(course.estadoCodigo) }}
                  </span>
                </div>
                <!-- Actions Menu -->
                <div class="absolute top-3 right-3">
                  <button
                    [matMenuTriggerFor]="menu"
                    class="p-2 bg-white/90 dark:bg-neutral-800/90 hover:bg-white dark:hover:bg-neutral-800 rounded-full transition-colors">
                    <mat-icon>more_vert</mat-icon>
                  </button>
                  <mat-menu #menu="matMenu">
                    <!-- Status Change Actions -->
                    @if (course.estadoCodigo !== 'PUB') {
                      <button mat-menu-item (click)="publishCourse(course)">
                        <mat-icon class="text-green-600">check_circle</mat-icon>
                        <span>Publicar</span>
                      </button>
                    }
                    @if (course.estadoCodigo !== 'BOR') {
                      <button mat-menu-item (click)="setToDraft(course)">
                        <mat-icon class="text-yellow-600">edit</mat-icon>
                        <span>Marcar como Borrador</span>
                      </button>
                    }
                    @if (course.estadoCodigo !== 'REV') {
                      <button mat-menu-item (click)="setToReview(course)">
                        <mat-icon class="text-blue-600">rate_review</mat-icon>
                        <span>Enviar a Revisión</span>
                      </button>
                    }
                    <mat-divider></mat-divider>
                    <!-- Course Management Actions -->
                    <button mat-menu-item (click)="editCourse(course.id)">
                      <mat-icon>edit</mat-icon>
                      <span>Editar Información</span>
                    </button>
                    <button mat-menu-item (click)="manageCourse(course.id)">
                      <mat-icon>video_library</mat-icon>
                      <span>Gestionar Contenido</span>
                    </button>
                    <button mat-menu-item (click)="duplicateCourse(course.id)">
                      <mat-icon>content_copy</mat-icon>
                      <span>Duplicar Curso</span>
                    </button>
                    <mat-divider></mat-divider>
                    <button mat-menu-item class="text-red-600" (click)="deleteCourse(course.id)">
                      <mat-icon>delete</mat-icon>
                      <span>Eliminar</span>
                    </button>
                  </mat-menu>
                </div>
              </div>

              <!-- Course Content -->
              <div class="p-5">
                <!-- Course Title -->
                <h3 class="text-lg font-semibold text-neutral-900 dark:text-white mb-2 line-clamp-2 min-h-[3.5rem]">
                  {{ course.titulo }}
                </h3>

                <!-- Course Description -->
                <p class="text-sm text-neutral-600 dark:text-neutral-400 mb-4 line-clamp-2 min-h-[2.5rem]">
                  {{ course.descripcion }}
                </p>

                <!-- Course Meta Info -->
                <div class="space-y-2 text-sm text-neutral-600 dark:text-neutral-400 mb-4">
                  <div class="flex items-center gap-2">
                    <mat-icon class="text-base">category</mat-icon>
                    <span>{{ course.categoriaNombre || 'Sin categoría' }}</span>
                  </div>
                  <div class="flex items-center gap-2">
                    <mat-icon class="text-base">calendar_today</mat-icon>
                    <span>Creado: {{ formatDate(course.creadoEn) }}</span>
                  </div>
                </div>

                <!-- Price -->
                <div class="pt-4 border-t border-neutral-200 dark:border-neutral-700">
                  <div class="flex items-center justify-between">
                    <span class="text-sm text-neutral-600 dark:text-neutral-400">Precio:</span>
                    <span class="text-xl font-bold text-primary-600 dark:text-primary-400">
                      {{ formatPrice(course.precio) }}
                    </span>
                  </div>
                </div>

                <!-- Quick Actions -->
                <div class="mt-4 pt-4 border-t border-neutral-200 dark:border-neutral-700 flex gap-2">
                  <button
                    (click)="editCourse(course.id)"
                    class="flex-1 px-3 py-2 text-xs font-medium text-primary-700 dark:text-primary-400 bg-primary-50 dark:bg-primary-900/20 hover:bg-primary-100 dark:hover:bg-primary-900/40 rounded-lg transition-colors">
                    <mat-icon class="text-sm">edit</mat-icon>
                    Editar
                  </button>
                  <button
                    (click)="manageCourse(course.id)"
                    class="flex-1 px-3 py-2 text-xs font-medium text-neutral-700 dark:text-neutral-300 bg-neutral-100 dark:bg-neutral-700 hover:bg-neutral-200 dark:hover:bg-neutral-600 rounded-lg transition-colors">
                    <mat-icon class="text-sm">video_library</mat-icon>
                    Contenido
                  </button>
                </div>
              </div>
            </div>
          }
        </div>

        <!-- Results Count -->
        <div class="mt-6 text-sm text-neutral-600 dark:text-neutral-400 text-center">
          Mostrando {{ filteredCourses.length }} de {{ allCourses.length }} cursos
        </div>
      }

    </div>
  </div>
</main>
