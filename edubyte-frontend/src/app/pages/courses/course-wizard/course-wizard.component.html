<div class="min-h-screen bg-neutral-50 dark:bg-neutral-900 py-8">
  <div class="max-w-5xl mx-auto px-4">
    <!-- Header -->
    <div class="mb-8">
      <h1 class="text-3xl font-bold text-neutral-900 dark:text-white mb-2">Crear Nuevo Curso</h1>
      <p class="text-neutral-600 dark:text-neutral-400">Sigue los pasos para crear tu curso de manera completa</p>
    </div>

    <!-- Stepper -->
    <div class="mb-8">
      <div class="flex items-center justify-between">
        @for (step of [1, 2, 3]; track step) {
          <div class="flex items-center" [class.flex-1]="step < 3">
            <div
              class="flex items-center justify-center w-10 h-10 rounded-full font-semibold transition-colors"
              [class.bg-primary-600]="step <= currentStep"
              [class.text-white]="step <= currentStep"
              [class.bg-neutral-200]="step > currentStep"
              [class.dark:bg-neutral-700]="step > currentStep"
              [class.text-neutral-600]="step > currentStep"
              [class.dark:text-neutral-400]="step > currentStep">
              {{ getStepIcon(step) }}
            </div>
            @if (step < 3) {
              <div
                class="flex-1 h-1 mx-2 transition-colors"
                [class.bg-primary-600]="step < currentStep"
                [class.bg-neutral-200]="step >= currentStep"
                [class.dark:bg-neutral-700]="step >= currentStep">
              </div>
            }
          </div>
        }
      </div>
      <div class="flex justify-between mt-2">
        <span class="text-sm font-medium" [class.text-primary-600]="currentStep === 1" [class.text-neutral-600]="currentStep !== 1" [class.dark:text-neutral-400]="currentStep !== 1">Información</span>
        <span class="text-sm font-medium" [class.text-primary-600]="currentStep === 2" [class.text-neutral-600]="currentStep !== 2" [class.dark:text-neutral-400]="currentStep !== 2">Contenido</span>
        <span class="text-sm font-medium" [class.text-primary-600]="currentStep === 3" [class.text-neutral-600]="currentStep !== 3" [class.dark:text-neutral-400]="currentStep !== 3">Revisar</span>
      </div>
    </div>

    <!-- Content Card -->
    <div class="bg-white dark:bg-neutral-800 rounded-lg shadow-lg p-6 mb-6">
      <!-- Step 1: Course Information -->
      @if (currentStep === 1) {
        <form [formGroup]="courseInfoForm">
          <h2 class="text-2xl font-bold text-neutral-900 dark:text-white mb-6">Información del Curso</h2>

          <div class="space-y-4">
            <!-- Title -->
            <div>
              <label class="block text-sm font-medium text-neutral-700 dark:text-neutral-300 mb-1">
                Título del Curso *
              </label>
              <input
                type="text"
                formControlName="titulo"
                placeholder="Ej: Introducción a JavaScript"
                class="w-full px-4 py-2 border border-neutral-300 dark:border-neutral-600 rounded-lg bg-white dark:bg-neutral-700 text-neutral-900 dark:text-white focus:ring-2 focus:ring-primary-500 focus:border-transparent">
              @if (courseInfoForm.get('titulo')?.touched && courseInfoForm.get('titulo')?.errors?.['required']) {
                <p class="text-sm text-red-600 dark:text-red-400 mt-1">El título es requerido</p>
              }
              @if (courseInfoForm.get('titulo')?.touched && courseInfoForm.get('titulo')?.errors?.['minlength']) {
                <p class="text-sm text-red-600 dark:text-red-400 mt-1">El título debe tener al menos 5 caracteres</p>
              }
            </div>

            <!-- Description -->
            <div>
              <label class="block text-sm font-medium text-neutral-700 dark:text-neutral-300 mb-1">
                Descripción *
              </label>
              <textarea
                formControlName="descripcion"
                rows="4"
                placeholder="Describe qué aprenderán los estudiantes en este curso..."
                class="w-full px-4 py-2 border border-neutral-300 dark:border-neutral-600 rounded-lg bg-white dark:bg-neutral-700 text-neutral-900 dark:text-white focus:ring-2 focus:ring-primary-500 focus:border-transparent"></textarea>
              @if (courseInfoForm.get('descripcion')?.touched && courseInfoForm.get('descripcion')?.errors?.['required']) {
                <p class="text-sm text-red-600 dark:text-red-400 mt-1">La descripción es requerida</p>
              }
              @if (courseInfoForm.get('descripcion')?.touched && courseInfoForm.get('descripcion')?.errors?.['minlength']) {
                <p class="text-sm text-red-600 dark:text-red-400 mt-1">La descripción debe tener al menos 20 caracteres</p>
              }
            </div>

            <!-- Category and Price -->
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
              <div>
                <label class="block text-sm font-medium text-neutral-700 dark:text-neutral-300 mb-1">
                  Categoría *
                </label>
                <select
                  formControlName="categoriaId"
                  class="w-full px-4 py-2 border border-neutral-300 dark:border-neutral-600 rounded-lg bg-white dark:bg-neutral-700 text-neutral-900 dark:text-white focus:ring-2 focus:ring-primary-500 focus:border-transparent">
                  <option [value]="null">Selecciona una categoría</option>
                  @for (category of categories; track category.id) {
                    <option [value]="category.id">{{ category.name }}</option>
                  }
                </select>
                @if (courseInfoForm.get('categoriaId')?.touched && courseInfoForm.get('categoriaId')?.errors?.['required']) {
                  <p class="text-sm text-red-600 dark:text-red-400 mt-1">La categoría es requerida</p>
                }
              </div>

              <div>
                <label class="block text-sm font-medium text-neutral-700 dark:text-neutral-300 mb-1">
                  Precio *
                </label>
                <input
                  type="number"
                  formControlName="precio"
                  min="0"
                  step="0.01"
                  placeholder="0.00"
                  class="w-full px-4 py-2 border border-neutral-300 dark:border-neutral-600 rounded-lg bg-white dark:bg-neutral-700 text-neutral-900 dark:text-white focus:ring-2 focus:ring-primary-500 focus:border-transparent">
                @if (courseInfoForm.get('precio')?.touched && courseInfoForm.get('precio')?.errors?.['required']) {
                  <p class="text-sm text-red-600 dark:text-red-400 mt-1">El precio es requerido</p>
                }
              </div>
            </div>

            <!-- Image Upload -->
            <div>
              <label class="block text-sm font-medium text-neutral-700 dark:text-neutral-300 mb-1">
                Imagen del Curso
              </label>
              <div class="mt-1 flex justify-center px-6 pt-5 pb-6 border-2 border-neutral-300 dark:border-neutral-600 border-dashed rounded-lg hover:border-primary-400 transition-colors">
                <div class="space-y-1 text-center">
                  @if (imagePreview) {
                    <div class="mb-4">
                      <img [src]="imagePreview" alt="Preview" class="max-h-48 mx-auto rounded-lg">
                    </div>
                  } @else {
                    <svg class="mx-auto h-12 w-12 text-neutral-400" stroke="currentColor" fill="none" viewBox="0 0 48 48">
                      <path d="M28 8H12a4 4 0 00-4 4v20m32-12v8m0 0v8a4 4 0 01-4 4H12a4 4 0 01-4-4v-4m32-4l-3.172-3.172a4 4 0 00-5.656 0L28 28M8 32l9.172-9.172a4 4 0 015.656 0L28 28m0 0l4 4m4-24h8m-4-4v8m-12 4h.02" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
                    </svg>
                  }
                  <div class="flex text-sm text-neutral-600 dark:text-neutral-400">
                    <label class="relative cursor-pointer rounded-md font-medium text-primary-600 hover:text-primary-500 focus-within:outline-none">
                      <span>Subir imagen</span>
                      <input type="file" class="sr-only" accept="image/*" (change)="onImageSelected($event)">
                    </label>
                    <p class="pl-1">o arrastra y suelta</p>
                  </div>
                  <p class="text-xs text-neutral-500 dark:text-neutral-400">PNG, JPG, GIF hasta 10MB</p>
                </div>
              </div>
            </div>
          </div>
        </form>
      }

      <!-- Step 2: Course Content -->
      @if (currentStep === 2) {
        <form [formGroup]="contentForm">
          <div class="flex justify-between items-center mb-6">
            <h2 class="text-2xl font-bold text-neutral-900 dark:text-white">Contenido del Curso</h2>
            <button
              type="button"
              (click)="addSection()"
              class="px-4 py-2 bg-primary-600 text-white rounded-lg hover:bg-primary-700 transition-colors">
              + Agregar Sección
            </button>
          </div>

          @if (secciones.length === 0) {
            <div class="text-center py-12 bg-neutral-50 dark:bg-neutral-900 rounded-lg border-2 border-dashed border-neutral-300 dark:border-neutral-600">
              <p class="text-neutral-600 dark:text-neutral-400">No hay secciones aún. Haz clic en "Agregar Sección" para comenzar.</p>
            </div>
          }

          <!-- Sections -->
          <div class="space-y-6">
            @for (section of secciones.controls; track section; let sectionIndex = $index) {
              <div class="border border-neutral-300 dark:border-neutral-600 rounded-lg p-4 bg-neutral-50 dark:bg-neutral-900">
                <div class="flex justify-between items-start mb-4">
                  <h3 class="text-lg font-semibold text-neutral-900 dark:text-white">Sección {{ sectionIndex + 1 }}</h3>
                  <button
                    type="button"
                    (click)="removeSection(sectionIndex)"
                    class="text-red-600 hover:text-red-700 dark:text-red-400 dark:hover:text-red-300">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                    </svg>
                  </button>
                </div>

                <div [formGroup]="getSectionFormGroup(sectionIndex)" class="space-y-4">
                  <!-- Section Title -->
                  <div>
                    <label class="block text-sm font-medium text-neutral-700 dark:text-neutral-300 mb-1">
                      Título de la Sección *
                    </label>
                    <input
                      type="text"
                      formControlName="titulo"
                      placeholder="Ej: Introducción a los conceptos básicos"
                      class="w-full px-4 py-2 border border-neutral-300 dark:border-neutral-600 rounded-lg bg-white dark:bg-neutral-700 text-neutral-900 dark:text-white focus:ring-2 focus:ring-primary-500 focus:border-transparent">
                  </div>

                  <!-- Duration -->
                  <div>
                    <label class="block text-sm font-medium text-neutral-700 dark:text-neutral-300 mb-1">
                      Duración Estimada (minutos)
                    </label>
                    <input
                      type="number"
                      formControlName="duracionEstimada"
                      min="0"
                      placeholder="30"
                      class="w-full px-4 py-2 border border-neutral-300 dark:border-neutral-600 rounded-lg bg-white dark:bg-neutral-700 text-neutral-900 dark:text-white focus:ring-2 focus:ring-primary-500 focus:border-transparent">
                  </div>

                  <!-- Lessons -->
                  <div class="mt-4">
                    <div class="flex justify-between items-center mb-2">
                      <label class="block text-sm font-medium text-neutral-700 dark:text-neutral-300">
                        Lecciones
                      </label>
                      <button
                        type="button"
                        (click)="addLesson(sectionIndex)"
                        class="text-sm px-3 py-1 bg-primary-500 text-white rounded hover:bg-primary-600 transition-colors">
                        + Agregar Lección
                      </button>
                    </div>

                    @if (getLecciones(sectionIndex).length === 0) {
                      <p class="text-sm text-neutral-500 dark:text-neutral-400 italic py-2">No hay lecciones en esta sección</p>
                    }

                    <div class="space-y-3">
                      @for (lesson of getLecciones(sectionIndex).controls; track lesson; let lessonIndex = $index) {
                        <div [formGroup]="getLessonFormGroup(sectionIndex, lessonIndex)" class="border border-neutral-200 dark:border-neutral-700 rounded-lg p-3 bg-white dark:bg-neutral-800">
                          <div class="flex justify-between items-start mb-2">
                            <h4 class="text-sm font-semibold text-neutral-800 dark:text-neutral-200">Lección {{ lessonIndex + 1 }}</h4>
                            <button
                              type="button"
                              (click)="removeLesson(sectionIndex, lessonIndex)"
                              class="text-red-600 hover:text-red-700 dark:text-red-400 dark:hover:text-red-300">
                              <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                              </svg>
                            </button>
                          </div>

                          <div class="space-y-2">
                            <div>
                              <input
                                type="text"
                                formControlName="titulo"
                                placeholder="Título de la lección"
                                class="w-full px-3 py-2 text-sm border border-neutral-300 dark:border-neutral-600 rounded bg-white dark:bg-neutral-700 text-neutral-900 dark:text-white focus:ring-2 focus:ring-primary-500 focus:border-transparent">
                            </div>

                            <div class="grid grid-cols-2 gap-2">
                              <select
                                formControlName="tipo"
                                class="w-full px-3 py-2 text-sm border border-neutral-300 dark:border-neutral-600 rounded bg-white dark:bg-neutral-700 text-neutral-900 dark:text-white focus:ring-2 focus:ring-primary-500 focus:border-transparent">
                                @for (type of lessonTypes; track type.value) {
                                  <option [value]="type.value">{{ type.label }}</option>
                                }
                              </select>

                              <input
                                type="text"
                                formControlName="url"
                                placeholder="URL del video/recurso"
                                class="w-full px-3 py-2 text-sm border border-neutral-300 dark:border-neutral-600 rounded bg-white dark:bg-neutral-700 text-neutral-900 dark:text-white focus:ring-2 focus:ring-primary-500 focus:border-transparent">
                            </div>

                            <textarea
                              formControlName="contenido"
                              rows="2"
                              placeholder="Contenido adicional o descripción"
                              class="w-full px-3 py-2 text-sm border border-neutral-300 dark:border-neutral-600 rounded bg-white dark:bg-neutral-700 text-neutral-900 dark:text-white focus:ring-2 focus:ring-primary-500 focus:border-transparent"></textarea>
                          </div>
                        </div>
                      }
                    </div>
                  </div>
                </div>
              </div>
            }
          </div>
        </form>
      }

      <!-- Step 3: Review -->
      @if (currentStep === 3) {
        <div>
          <h2 class="text-2xl font-bold text-neutral-900 dark:text-white mb-6">Revisar y Publicar</h2>

          <div class="space-y-6">
            <!-- Course Info Summary -->
            <div class="border border-neutral-300 dark:border-neutral-600 rounded-lg p-4">
              <h3 class="text-lg font-semibold text-neutral-900 dark:text-white mb-4">Información del Curso</h3>
              <div class="grid grid-cols-2 gap-4 text-sm">
                <div>
                  <span class="text-neutral-600 dark:text-neutral-400">Título:</span>
                  <p class="font-medium text-neutral-900 dark:text-white">{{ courseInfoForm.value.titulo }}</p>
                </div>
                <div>
                  <span class="text-neutral-600 dark:text-neutral-400">Precio:</span>
                  <p class="font-medium text-neutral-900 dark:text-white">${{ courseInfoForm.value.precio }}</p>
                </div>
                <div class="col-span-2">
                  <span class="text-neutral-600 dark:text-neutral-400">Descripción:</span>
                  <p class="font-medium text-neutral-900 dark:text-white">{{ courseInfoForm.value.descripcion }}</p>
                </div>
              </div>
              @if (imagePreview) {
                <div class="mt-4">
                  <span class="text-neutral-600 dark:text-neutral-400 text-sm">Imagen:</span>
                  <img [src]="imagePreview" alt="Preview" class="mt-2 max-h-32 rounded-lg">
                </div>
              }
            </div>

            <!-- Content Summary -->
            <div class="border border-neutral-300 dark:border-neutral-600 rounded-lg p-4">
              <h3 class="text-lg font-semibold text-neutral-900 dark:text-white mb-4">Contenido del Curso</h3>

              @if (secciones.length === 0) {
                <p class="text-neutral-600 dark:text-neutral-400 text-sm">No hay contenido agregado</p>
              } @else {
                <div class="space-y-3">
                  @for (section of secciones.controls; track section; let sectionIndex = $index) {
                    <div class="bg-neutral-50 dark:bg-neutral-900 rounded p-3">
                      <p class="font-medium text-neutral-900 dark:text-white">
                        {{ sectionIndex + 1 }}. {{ section.value.titulo }}
                      </p>
                      <p class="text-sm text-neutral-600 dark:text-neutral-400 mt-1">
                        {{ getLecciones(sectionIndex).length }} lección(es)
                        @if (section.value.duracionEstimada) {
                          - {{ section.value.duracionEstimada }} minutos
                        }
                      </p>
                    </div>
                  }
                </div>
              }
            </div>

            <!-- Info Box -->
            <div class="bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-lg p-4">
              <div class="flex">
                <svg class="w-5 h-5 text-blue-600 dark:text-blue-400 mr-2 flex-shrink-0" fill="currentColor" viewBox="0 0 20 20">
                  <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"></path>
                </svg>
                <div class="text-sm text-blue-800 dark:text-blue-200">
                  <p class="font-medium mb-1">Importante</p>
                  <p>El curso se guardará como <strong>borrador</strong>. Podrás editarlo y publicarlo más tarde desde tu panel de instructor.</p>
                </div>
              </div>
            </div>
          </div>
        </div>
      }
    </div>

    <!-- Navigation Buttons -->
    <div class="flex justify-between">
      <button
        type="button"
        (click)="previousStep()"
        [disabled]="currentStep === 1"
        class="px-6 py-2 border border-neutral-300 dark:border-neutral-600 text-neutral-700 dark:text-neutral-300 rounded-lg hover:bg-neutral-50 dark:hover:bg-neutral-800 transition-colors disabled:opacity-50 disabled:cursor-not-allowed">
        Anterior
      </button>

      <div class="flex gap-2">
        @if (currentStep === 3) {
          <button
            type="button"
            (click)="saveDraft()"
            [disabled]="isSubmitting"
            class="px-6 py-2 border border-primary-600 text-primary-600 rounded-lg hover:bg-primary-50 dark:hover:bg-primary-900/20 transition-colors disabled:opacity-50">
            Guardar Borrador
          </button>
        }

        @if (currentStep < 3) {
          <button
            type="button"
            (click)="nextStep()"
            class="px-6 py-2 bg-primary-600 text-white rounded-lg hover:bg-primary-700 transition-colors">
            Siguiente
          </button>
        } @else {
          <button
            type="button"
            (click)="publishCourse()"
            [disabled]="isSubmitting"
            class="px-6 py-2 bg-primary-600 text-white rounded-lg hover:bg-primary-700 transition-colors disabled:opacity-50">
            @if (isSubmitting) {
              <span>Creando...</span>
            } @else {
              <span>Crear Curso</span>
            }
          </button>
        }
      </div>
    </div>
  </div>
</div>
