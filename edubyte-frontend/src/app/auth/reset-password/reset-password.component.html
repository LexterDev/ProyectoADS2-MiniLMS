<div class="flex min-h-screen flex-col items-center justify-center p-4 bg-background-light dark:bg-background-dark">
  <div class="w-full max-w-md">

    <div class="text-center mb-8">
      <div class="inline-flex items-center justify-center bg-primary/10 dark:bg-primary/20 rounded-full p-4 mb-6">
        <span class="material-symbols-outlined text-primary" style="font-size: 48px;">lock_reset</span>
      </div>
      <h1 class="text-3xl font-bold text-slate-900 dark:text-white">Restablecer Contraseña</h1>
      <p class="text-slate-600 dark:text-slate-400 mt-2">
        Ingresa tu nueva contraseña
      </p>
    </div>

    <div *ngIf="checkingToken" class="bg-white dark:bg-slate-900 shadow-sm rounded-xl p-8 border border-slate-200 dark:border-slate-800 text-center">
      <p class="text-slate-600 dark:text-slate-400">Validando token...</p>
    </div>

    <div *ngIf="!checkingToken && !tokenValid" class="bg-white dark:bg-slate-900 shadow-sm rounded-xl p-8 border border-slate-200 dark:border-slate-800">
      <div class="rounded-xl border border-red-400 bg-red-50 dark:bg-red-900/20 dark:border-red-700 p-4 mb-6">
        <p class="text-sm font-medium text-red-800 dark:text-red-300">{{ errorMessage }}</p>
      </div>
      <a [routerLink]="['/auth/forgot-password']" class="text-primary hover:text-primary/90 font-medium">Solicitar nuevo enlace</a>
    </div>

    <div *ngIf="!checkingToken && tokenValid" class="bg-white dark:bg-slate-900 shadow-sm rounded-xl p-8 border border-slate-200 dark:border-slate-800">
      <form [formGroup]="resetPasswordForm" (ngSubmit)="onSubmit()" novalidate>
        <div class="space-y-6">

          <div>
            <label for="password" class="block text-sm font-medium text-slate-700 dark:text-slate-300">Nueva Contraseña</label>
            <div class="mt-1 relative">
              <input
                [type]="passwordFieldType"
                id="password"
                formControlName="password"
                placeholder="Mínimo 6 caracteres"
                class="block w-full appearance-none rounded-xl border border-slate-300 dark:border-slate-700 bg-background-light dark:bg-slate-900/70 px-3 py-3 pr-10 placeholder-slate-400 dark:placeholder-slate-500 shadow-sm focus:border-primary focus:outline-none focus:ring-primary sm:text-sm"
                [ngClass]="{ 'border-red-500 focus:border-red-500 focus:ring-red-500': submitted && f['password'].errors }"
              />
              <button
                type="button"
                (click)="togglePasswordVisibility('password')"
                class="absolute inset-y-0 right-0 flex items-center pr-3"
              >
                <span class="material-symbols-outlined text-slate-400 hover:text-slate-600 dark:hover:text-slate-300" style="font-size: 20px;">
                  {{ passwordFieldType === 'password' ? 'visibility' : 'visibility_off' }}
                </span>
              </button>
            </div>
            <div *ngIf="submitted && f['password'].errors" class="mt-2 text-sm text-red-600">
              <div *ngIf="f['password'].errors['required']">La contraseña es requerida.</div>
              <div *ngIf="f['password'].errors['minlength']">La contraseña debe tener al menos 6 caracteres.</div>
            </div>
          </div>

          <div>
            <label for="confirmPassword" class="block text-sm font-medium text-slate-700 dark:text-slate-300">Confirmar Contraseña</label>
            <div class="mt-1 relative">
              <input
                [type]="confirmPasswordFieldType"
                id="confirmPassword"
                formControlName="confirmPassword"
                placeholder="Repite la contraseña"
                class="block w-full appearance-none rounded-xl border border-slate-300 dark:border-slate-700 bg-background-light dark:bg-slate-900/70 px-3 py-3 pr-10 placeholder-slate-400 dark:placeholder-slate-500 shadow-sm focus:border-primary focus:outline-none focus:ring-primary sm:text-sm"
                [ngClass]="{ 'border-red-500 focus:border-red-500 focus:ring-red-500': submitted && (f['confirmPassword'].errors || resetPasswordForm.errors?.['mismatch']) }"
              />
              <button
                type="button"
                (click)="togglePasswordVisibility('confirm')"
                class="absolute inset-y-0 right-0 flex items-center pr-3"
              >
                <span class="material-symbols-outlined text-slate-400 hover:text-slate-600 dark:hover:text-slate-300" style="font-size: 20px;">
                  {{ confirmPasswordFieldType === 'password' ? 'visibility' : 'visibility_off' }}
                </span>
              </button>
            </div>
            <div *ngIf="submitted && f['confirmPassword'].errors" class="mt-2 text-sm text-red-600">
              <div *ngIf="f['confirmPassword'].errors['required']">Debes confirmar la contraseña.</div>
              <div *ngIf="f['confirmPassword'].errors['mismatch']">Las contraseñas no coinciden.</div>
            </div>
          </div>

          <div *ngIf="successMessage" class="rounded-xl border border-green-400 bg-green-50 dark:bg-green-900/20 dark:border-green-700 p-4">
            <p class="text-sm font-medium text-green-800 dark:text-green-300">{{ successMessage }}</p>
          </div>

          <div *ngIf="errorMessage" class="rounded-xl border border-red-400 bg-red-50 dark:bg-red-900/20 dark:border-red-700 p-4">
            <p class="text-sm font-medium text-red-800 dark:text-red-300">{{ errorMessage }}</p>
          </div>

          <div>
            <button
              type="submit"
              class="flex w-full justify-center rounded-xl bg-primary px-3 py-3 text-sm font-semibold text-white shadow-sm hover:bg-primary/90 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-primary"
            >
              Restablecer Contraseña
            </button>
          </div>
        </div>
      </form>
    </div>

    <p class="mt-8 text-center text-sm text-slate-600 dark:text-slate-400">
      <a [routerLink]="['/login']" class="font-medium text-primary hover:text-primary/90">Volver a iniciar sesión</a>
    </p>

  </div>
</div>
